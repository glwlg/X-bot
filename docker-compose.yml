name: x-bot
services:
  x-bot:
    build: .
    container_name: x-bot
    env_file:
      - .env
    restart: unless-stopped
    environment:
      - TZ=Asia/Shanghai
      - SEARXNG_URL=http://127.0.0.1:28080
    network_mode: "host"
    volumes:
      - ./downloads:/app/downloads
      - ./data:/app/data
      # Deployment Staging: 宿主机路径必须与容器内路径一致
      # 这是因为 x-bot 调度的是宿主机 Docker，docker compose 会使用宿主机路径
      # 必须在 .env 中设置 X_DEPLOYMENT_STAGING_PATH 为绝对路径！
      - ${X_DEPLOYMENT_STAGING_PATH}:${X_DEPLOYMENT_STAGING_PATH}
      - ./skills:/app/skills # 持久化学习到的 Skills
      - /mnt/d/media/dlp:/app/media
      - /var/run/docker.sock:/var/run/docker.sock # MCP: 允许启动 MCP 服务容器

  x-bot-worker:
    build: .
    container_name: x-bot-worker
    env_file:
      - .env
    restart: unless-stopped
    network_mode: "host"
    command: [ "python", "-m", "worker_runtime.daemon" ]
    volumes:
      - ./data:/app/data
      - ./downloads:/app/downloads
      - ./skills:/app/skills
      - /var/run/docker.sock:/var/run/docker.sock
