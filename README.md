# X-Bot

**X-Bot** 是一个全能型 AI Telegram 机器人，集成了多平台媒体下载、智能对话、文档分析、语音交互和 AI 绘图功能。

它不仅仅是一个下载工具，更是你的智能生活助手。

## 🏗️ 系统架构

> **开发者说明**：详细的系统架构图、模块说明及开发指南，请参阅独立的开发文档：
> 
> 📚 **[X-Bot 开发手册 (DEVELOPMENT.md)](DEVELOPMENT.md)**

## ✨ 核心功能

### 🤖 强大的 AI 能力
-   **多轮智能对话**：基于 Gemini 2.0 Flash 模型，支持深层上下文理解。
-   **🧠 长期记忆 (New)**：
    -   **个性化记忆**：自动记住你的偏好、习惯和重要信息（如“我住在北京”，“不要吃辣”）。
    -   **隐私隔离**：采用**物理级文件隔离**架构，每个用户的记忆存储在独立的加密空间，绝无数据混淆风险。
-   **多模态分析**：
    -   **图片分析**：发送图片，AI 识别内容并回答问题。
    -   **视频分析**：发送视频，AI 理解画面并进行总结或问答。
    -   **语音/音频分析**：支持语音消息及 .m4a/.mp3 等音频文件，自动转录并回复（支持 Caption 指令）。
    -   **文档分析**：支持 PDF 和 DOCX 文档，提取内容并回答相关问题。
-   **网页摘要**：发送链接，自动抓取网页内容并生成精简摘要。
-   **AI 绘图**：使用 Google Imagen 3 模型，根据描述生成高质量图像。

### 📹 全能媒体下载
-   **支持平台**：YouTube, X (Twitter), Instagram, TikTok, Bilibili 等。
-   **多种格式**：支持下载高清视频或仅提取音频 (MP3)。
-   **智能处理**：
    -   **秒传技术**：智能文件缓存与去重，已下载内容无需重复下载。
    -   **大文件提示**：若视频/音频超过 Telegram 20MB 下载限制，Bot 会给出友好提示。

### 📊 数据持久化与统计
-   **SQLite 数据库**：所有数据（对话历史、文件映射、用户统计）持久化存储。
-   **Docker 卷映射**：重启容器不丢失任何数据。
-   **使用统计**：通过 `/stats` 命令随时查看个人使用数据。

## ✨ 进阶功能

### 📈 股票盯盘 (New)
-   **实时监控**：在交易时段（美股/港股/A股）实时监控自选股价格。
-   **智能推送**：当股价发生显著波动时自动推送消息。
-   **指令**：使用 `/watchlist` 管理自选股。

### 🌍 沉浸式翻译
-   **双向翻译**：开启后，自动将外语翻译为中文，中文翻译为英文。
-   **无缝体验**：使用 `/translate` 开启/关闭，专为跨语言交流设计。

### 📢 订阅监控
-   **RSS/关键词监控**：使用 `/monitor <关键词>` 或 `/subscribe <URL>` 订阅感兴趣的内容。
-   **自动推送**：Bot 每 30 分钟检查一次，发现新内容自动推送到聊天窗口。

### 💡 需求收集
-   **提交想法**：有新功能想要？使用 `/feature` 进入交互式需求提交模式。
-   **AI 生成文档**：Bot 会协助你完善需求，并自动生成结构化的需求文档。

### 🔗 智能链接与上下文
-   **智能引用**：引用一条包含链接/新闻的消息并发送 "总结一下"，Bot 会自动抓取原链接内容作为上下文进行回答。
-   **深度解析**：内置 Google News 解码器与反爬虫兜底策略，确保能获取到最真实的网页内容。

### 💬 自然语言意图识别与所见即所得 (New)
-   **全自然语言交互**：无需死记硬背 `/download` 或 `/remind`，直接说出你的需求。
-   **智能路由**：
    -   发送 "下载这个视频 https://..." -> 自动识别并下载
    -   发送 "10分钟后提醒我喝水" -> 自动设置提醒
    -   发送 "画一只猫" -> 自动调用 AI 绘图
    -   发送 "订阅这个RSS https://..." -> 自动添加订阅
    -   发送 "帮我关注英伟达" -> 自动添加自选股
    -   发送 "监控关键词 AI" -> 自动开始监控

### 💡 Skill 系统 - 让 AI 拥有无限可能 (New)
-   **自我进化**：使用 `/teach` 教 Bot 学会新技能（例如 "教你查天气"）。
-   **自动生成**：AI 会自动编写代码、进行安全检查并热加载新能力。
-   **内置能力**：下载、提醒、股票、RSS 等功能现已全部重构为 Skill。
-   **Skill 市场**：未来将支持分享和安装社区开发的 Skill。

## 🚀 快速部署

### 1. 准备环境
确保已安装 [Docker](https://docs.docker.com/get-docker/) 和 [Docker Compose](https://docs.docker.com/compose/install/)。

### 2. 获取配置
创建一个 `.env` 文件（参考 `.env.example`）：

```ini
# Telegram
TELEGRAM_BOT_TOKEN="你的 Bot Token"

# Gemini AI (https://aistudio.google.com/)
GEMINI_API_KEY="你的 API Key"
GEMINI_MODEL="gemini-2.0-flash"
CREATOR_MODEL="gemini-2.0-pro-exp-02-11" # 用于生成 Skill 代码的强力模型
IMAGE_MODEL="imagen-3.0-generate-002"

# 访问控制 (可选)
# ADMIN_USER_IDS: 管理员 ID 列表，拥有 /adduser 和 /deluser 权限
ADMIN_USER_IDS="123456789"
```

### 3. 一键启动
```bash
docker-compose up --build -d
```

### 4. 数据管理
所有持久化数据存储在 `./data`（数据库）、`./downloads`（媒体）和 `./skills`（技能）目录。

### 5. 权限管理
 Bot 启动后，管理员可以使用以下命令动态管理允许使用的用户白名单：
 - `/adduser <user_id> [备注]` : 添加用户到白名单
 - `/deluser <user_id>` : 从白名单移除用户
 - 所有白名单用户的权限数据将持久化保存在数据库中。

## 🤖 使用指南

### 常用命令
-   `/start` - 呼出主菜单
-   `/new` - 开启新话题（清除上下文）
-   `/image` - 快速进入画图模式
-   `/teach` - 教 Bot 新能力 (Core!)
-   `/skills` - 查看拥有的能力
-   `/feature` - 提交新功能需求
-   `/stats` - 查看我的使用统计
-   `/help` - 查看帮助信息
-   `/adduser` / `/deluser` - 用户权限管理（仅管理员）

### 交互方式
-   **直接对话**：像和真人聊天一样，直接说出你的需求。
-   **教它做事**：如果它不会，试着说 "/teach 教你查汇率"。
-   **多模态**：发送图片问 "这是什么"，发送视频说 "总结一下"。

---
Enjoy X-Bot! 🚀
